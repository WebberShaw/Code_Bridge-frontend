<!DOCTYPE html>
<html lang="en">
<style>
    .avatar-uploader .el-upload {
        border: 1px dashed #d9d9d9;
        border-radius: 6px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    .avatar-uploader .el-upload:hover {
        border-color: #409EFF;
    }
    .avatar-uploader-icon {
        font-size: 28px;
        color: #8c939d;
        width: 178px;
        height: 178px;
        line-height: 178px;
        text-align: center;
    }
    .avatar {
        width: 178px;
        height: 178px;
        display: block;
    }
</style>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>完善信息 - Code Bridge 码 桥</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css?h=cb606d99bb2418df19b6bc818b41e412">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css?h=c6d4f54ff5f7e221a70cdd46daa396b3">
    <link rel="stylesheet" href="assets/fonts/material-icons.min.css?h=c6d4f54ff5f7e221a70cdd46daa396b3">
    <link rel="stylesheet" href="assets/css/styles.min.css?h=f92990a3598248b4ed1a61d7c5873f53">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>

<body id="page-top">
    <div id="wrapper">
        <!-- Start: Sidebar -->
        <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0">
            <div class="container-fluid d-flex flex-column p-0"><a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                    <div class="sidebar-brand-icon rotate-n-15"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-code-square" style="font-size: 38px;">
                            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"></path>
                            <path d="M6.854 4.646a.5.5 0 0 1 0 .708L4.207 8l2.647 2.646a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 0 1 .708 0zm2.292 0a.5.5 0 0 0 0 .708L11.793 8l-2.647 2.646a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708 0z"></path>
                        </svg></div>
                    <div class="sidebar-brand-text mx-3"><span>Code Bridge</span></div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul class="navbar-nav text-light" id="accordionSidebar">
                    <li class="nav-item"><a class="nav-link" href="my.html"><i class="fas fa-tachometer-alt"></i><span>个人中心</span></a></li>
                    <hr class="sidebar-divider">
                    <div class="sidebar-heading">
                        <p class="text-white-50 mb-0">课程管理</p>
                    </div>
                    <li class="nav-item">
                        <div><a class="btn btn-link nav-link" data-bs-toggle="collapse" aria-expanded="false" aria-controls="collapse-1" href="#collapse-1" role="button"><i class="fas fa-folder"></i>&nbsp;<span>课程</span></a>
                            <div class="collapse" id="collapse-1">
                                <div class="bg-white border rounded py-2 collapse-inner">
                                    <h6 class="collapse-header">增加课程</h6><a class="collapse-item" href="search-class.html">查找公开课</a>
                                    <h6 class="collapse-header">我学的课</h6><a class="collapse-item" href="myclass.html">查看课程</a><a class="collapse-item" href="class-notice.html">课程通知</a><a class="collapse-item" href="add-class.html">新增课程</a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div><a class="btn btn-link nav-link" data-bs-toggle="collapse" aria-expanded="false" aria-controls="collapse-2" href="#collapse-2" role="button"><i class="fas fa-wrench"></i>&nbsp;<span>教学</span></a>
                            <div class="collapse" id="collapse-2">
                                <div class="bg-white border rounded py-2 collapse-inner">
                                    <h6 class="collapse-header">课程管理</h6><a class="collapse-item" href="my-created.html">我开的课</a><a class="collapse-item" href="create-a-course.html">新开课程</a><a class="collapse-item" href="create-model.html">新建课程模板</a><a class="collapse-item" href="search-model.html">查找课程模板</a><a class="collapse-item" href="utilities-other.html">我带的班</a>
                                    <h6 class="collapse-header">资料库</h6><a class="collapse-item" href="resource-files.html">课程资源库</a><a class="collapse-item" href="resource-questions.html">题库</a><a class="collapse-item" href="resource-experiment.html">实验库</a><a class="collapse-item" href="my-resource.html">我的资料库</a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <hr class="sidebar-divider">
                    <div class="sidebar-heading">
                        <p class="text-white-50 mb-0">学校管理</p>
                    </div>
                    <li class="nav-item"><a class="nav-link" href="system-notice.html"><i class="fas fa-school"></i><span>&nbsp;教师认证</span></a><a class="nav-link" href="system-notice.html"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icon-tabler-manual-gearbox">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <circle cx="5" cy="6" r="2"></circle>
                                <circle cx="12" cy="6" r="2"></circle>
                                <circle cx="19" cy="6" r="2"></circle>
                                <circle cx="5" cy="18" r="2"></circle>
                                <circle cx="12" cy="18" r="2"></circle>
                                <line x1="5" y1="8" x2="5" y2="16"></line>
                                <line x1="12" y1="8" x2="12" y2="16"></line>
                                <path d="M19 8v2a2 2 0 0 1 -2 2h-12"></path>
                            </svg><span>&nbsp;校务管理</span></a></li>
                    <hr class="sidebar-divider">
                    <div class="sidebar-heading">
                        <p class="text-white-50 mb-0">我的</p>
                    </div>
                    <li class="nav-item"><a class="nav-link" href="system-notice.html"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-bell-fill">
                                <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zm.995-14.901a1 1 0 1 0-1.99 0A5.002 5.002 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901z"></path>
                            </svg><span>&nbsp;系统通知</span></a><a class="nav-link" href="profile.html"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-person-badge-fill">
                                <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm4.5 0a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3zM8 11a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm5 2.755C12.146 12.825 10.623 12 8 12s-4.146.826-5 1.755V14a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-.245z"></path>
                            </svg><span>&nbsp;资料设置</span></a><a class="nav-link" href="security-center.html"><i class="material-icons">security</i><span>&nbsp;安全中心</span></a></li>
                    <hr class="sidebar-divider">
                </ul>
                <div class="text-center d-none d-md-inline"><button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button></div>
            </div>
        </nav><!-- End: Sidebar -->
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                    <div class="container-fluid"><button class="btn btn-link d-md-none rounded-circle me-3" id="sidebarToggleTop-2" type="button"><i class="fas fa-bars"></i></button>
                        <form class="d-none d-sm-inline-block me-auto ms-md-3 my-2 my-md-0 mw-100 navbar-search" method="get" action="/search-class.html">
                            <div class="input-group"><input class="bg-light form-control border-0 small" type="text" placeholder="码桥公开课" name="search"><button class="btn btn-primary py-0" type="button"><i class="fas fa-search"></i></button></div>
                        </form>
                        <ul class="navbar-nav flex-nowrap ms-auto">
                            <li class="nav-item dropdown d-sm-none no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><i class="fas fa-search"></i></a>
                                <div class="dropdown-menu dropdown-menu-end p-3 animated--grow-in" aria-labelledby="searchDropdown">
                                    <form class="me-auto navbar-search w-100">
                                        <div class="input-group"><input class="bg-light form-control border-0 small" type="text" placeholder="Search for ...">
                                            <div class="input-group-append"><button class="btn btn-primary py-0" type="button"><i class="fas fa-search"></i></button></div>
                                        </div>
                                    </form>
                                </div>
                            </li>
                            <li class="nav-item dropdown no-arrow mx-1">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><span class="badge bg-danger badge-counter">3+</span><i class="fas fa-bell fa-fw"></i></a>
                                    <div class="dropdown-menu dropdown-menu-end dropdown-list animated--grow-in">
                                        <h6 class="dropdown-header">系统通知&nbsp;</h6><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3">
                                                <div class="bg-primary icon-circle"><i class="fas fa-file-alt text-white"></i></div>
                                            </div>
                                            <div><span class="small text-gray-500">December 12, 2019</span>
                                                <p>A new monthly report is ready to download!</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3">
                                                <div class="bg-success icon-circle"><i class="fas fa-donate text-white"></i></div>
                                            </div>
                                            <div><span class="small text-gray-500">December 7, 2019</span>
                                                <p>$290.29 has been deposited into your account!</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3">
                                                <div class="bg-warning icon-circle"><i class="fas fa-exclamation-triangle text-white"></i></div>
                                            </div>
                                            <div><span class="small text-gray-500">December 2, 2019</span>
                                                <p>Spending Alert: We've noticed unusually high spending for your account.</p>
                                            </div>
                                        </a><a class="dropdown-item text-center small text-gray-500" href="#">展示所有通知</a>
                                    </div>
                                </div>
                            </li>
                            <li class="nav-item dropdown no-arrow mx-1">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><span class="badge bg-danger badge-counter">7</span><i class="fas fa-envelope fa-fw"></i></a>
                                    <div class="dropdown-menu dropdown-menu-end dropdown-list animated--grow-in">
                                        <h6 class="dropdown-header">课程通知</h6><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="dropdown-list-image me-3"><img class="rounded-circle" src="assets/img/avatars/avatar4.jpeg?h=fefb30b61c8459a66bd338b7d790c3d5">
                                                <div class="bg-success status-indicator"></div>
                                            </div>
                                            <div class="fw-bold">
                                                <div class="text-truncate"><span>Hi there! I am wondering if you can help me with a problem I've been having.</span></div>
                                                <p class="small text-gray-500 mb-0">Emily Fowler - 58m</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="dropdown-list-image me-3"><img class="rounded-circle" src="assets/img/avatars/avatar2.jpeg?h=5d142be9441885f0935b84cf739d4112">
                                                <div class="status-indicator"></div>
                                            </div>
                                            <div class="fw-bold">
                                                <div class="text-truncate"><span>I have the photos that you ordered last month!</span></div>
                                                <p class="small text-gray-500 mb-0">Jae Chun - 1d</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="dropdown-list-image me-3"><img class="rounded-circle" src="assets/img/avatars/avatar3.jpeg?h=c5166867f10a4e454b5b2ae8d63268b3">
                                                <div class="bg-warning status-indicator"></div>
                                            </div>
                                            <div class="fw-bold">
                                                <div class="text-truncate"><span>Last month's report looks great, I am very happy with the progress so far, keep up the good work!</span></div>
                                                <p class="small text-gray-500 mb-0">Morgan Alvarez - 2d</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="dropdown-list-image me-3"><img class="rounded-circle" src="assets/img/avatars/avatar5.jpeg?h=35dc45edbcda6b3fc752dab2b0f082ea">
                                                <div class="bg-success status-indicator"></div>
                                            </div>
                                            <div class="fw-bold">
                                                <div class="text-truncate"><span>Am I a good boy? The reason I ask is because someone told me that people say this to all dogs, even if they aren't good...</span></div>
                                                <p class="small text-gray-500 mb-0">Chicken the Dog · 2w</p>
                                            </div>
                                        </a><a class="dropdown-item text-center small text-gray-500" href="class-notice.html">查看详细通知</a>
                                    </div>
                                </div>
                                <div class="shadow dropdown-list dropdown-menu dropdown-menu-end" aria-labelledby="alertsDropdown"></div>
                            </li>
                            <div class="d-none d-sm-block topbar-divider"></div>
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="my.html"><span class="d-none d-lg-inline me-2 text-gray-600 small">Valerie Luna</span><img class="border rounded-circle img-profile" src="assets/img/avatars/avatar1.jpeg?h=0ecc82101fb9a10ca459432faa8c0656"></a>
                                    <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in"><a class="dropdown-item" href="my.html"><i class="fas fa-user fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;个人中心</a><a class="dropdown-item" href="profile.html"><i class="fas fa-cogs fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;资料设置</a><a class="dropdown-item" href="#"><i class="fas fa-list fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;系统通知</a>
                                        <div class="dropdown-divider"></div><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;退出登录</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
                <div class="container-fluid">
                    <div class="container">
                        <div class="block-heading" style="padding-top: 0px;">
                            <h2 class="text-primary this-title" style="margin-top: 100px; text-align: center">绑定学校,完善信息<br></h2>
                            <p class="this-title"  style="text-align: center">教师用户完成绑定后需等待学校统一认证后方可正常使用</p>
                        </div>
                        <form action="index.html" method="post" class="profile-form" enctype="multipart/form-data" role="form" style="width:40%;margin: 0 auto;">
                            <div class="form-group mb-3"><label class="form-label">上传头像(非必填)</label>
                                <el-upload
                                        class="avatar-uploader"
                                        action="/files/uploadAvatar"
                                        :show-file-list="false"
                                        :on-success="handleAvatarSuccess"
                                        :before-upload="beforeAvatarUpload">
                                    <img v-if="imageUrl" :src="imageUrl" class="avatar">
                                    <i v-else class="el-icon-plus avatar-uploader-icon"></i>
                                </el-upload>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">个人简介(非必填)</label>
                                <input v-model="formData.intro" class="form-control" type="text" placeholder="这个人很懒，什么都没有写" name="intro" required="">
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">真实姓名</label>
                                <input v-model="formData.name" class="form-control" type="text" placeholder="张三" name="name" required="required">
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">我的学校</label>
                                <el-select v-model="formData.schoolId" filterable placeholder="我的学校">
                                    <el-option
                                            v-for="item in schools"
                                            :key="item.schoolName"
                                            :label="item.schoolName"
                                            :value="item.schoolId">
                                        <div style="display: flex;justify-content: center;align-content: center">
                                            <el-avatar size="small" :src="item.imagePath"></el-avatar>
                                            <label style="text-align: center">{{item.schoolName}}</label>
                                        </div>
                                    </el-option>

                                </el-select>
                            </div>
                            <div class="form-group mb-3"><label class="form-label">确认您的身份</label>
                                <br>
                                <el-radio v-model="formData.identity" label="0" border>学生</el-radio>
                                <el-radio v-model="formData.identity" label="3" border>教师</el-radio>
                            </div>
                            <div class="form-group mb-3" v-if="formData.identity==0">
                                <label class="form-label">学号</label>
                                <input v-model="formData.personId" class="form-control" type="text" placeholder="202200000000" name="personId" required="required">
                            </div>
                            <div class="form-group mb-3" v-else-if="formData.identity==3"><label class="form-label">教工号(教师账户需要待学校管理员统一认证后方可正常使用)</label><input v-model="formData.personId" class="form-control"
                                                                                                                                           type="text" autocomplete="off" placeholder="6100000" name="personId"
                                                                                                                                           title="教工号" required="required"></div>
                            <span>
                <div class="form-group mb-3"><label class="form-label">邮箱(非必填)</label>
                <br>
                    <div style="text-align: center;display: flex; justify-content: space-between;">
  <input v-model="formData.email" class="form-control" type="email" autocomplete="off" required="" placeholder="xxx@stu.hunau.edu.cn" name="email" title="输入您的邮箱" style="display: inline-block;width: 75%; float: left;">
  <button class="btn btn-primary" type="button" style="display: inline-block;float: right;margin-top: -20px; background-color: white; color:#adb5bd;" type="button" @click="sendEmail">发送验证码</button>
</div>

                    <!--                <input class="form-control"-->
                    <!--                    type="email" autocomplete="off" required="" placeholder="xxx@stu.hunau.edu.cn" name="email"-->
                    <!--                          title="输入您的邮箱"  style="width: 75%; float: left;">-->
                    <!--                    <button  class="btn btn-primary" style="float: right;margin-top: -20px; background-color: white; color:#adb5bd;" type="button">发送验证码</button>-->
                </div>


            </span>
                            <br>
                            <div class="form-group mb-3">
                                <label class="form-label">邮箱验证码</label>
                                <input class="form-control" type="text" placeholder="" name="verifyCode" required="" v-model="formData.verifyCode">
                            </div>
                            <!-- <span><input type="number" name="" id=""></span> -->
                            <br>
                            <hr style="margin-top: 30px;margin-bottom: 10px;">
                            <div class="form-group mb-3" >
                                <button class="btn btn-primary d-block w-100" type="button"  @click="submit">
                                    <i class="fas fa-save"></i>&nbsp;完成</button></div>
                        </form>
                        <div style="text-align: center">
                            <el-button @click="jump" type="info" plain >跳过</el-button>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="bg-white sticky-footer"></footer>
        </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </div>
    <script src="assets/bootstrap/js/bootstrap.min.js?h=79ff9637b74326c362fb6f7f5801a7ba"></script>
    <script src="assets/js/script.min.js?h=9d17dc34c7092d02ce216040067c0268"></script>
    <script src="assets/js/vue-2.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="assets/js/vue@2"></script>
    <script src="assets/js/axios.min.js"></script>
</body>

</html>

<script>
    var app = new Vue({
        el: '#wrapper',
        data:{
            schools:[],
            imageUrl: '',
            userInfo:null,
            formData:{
                intro:"",
                identity: '',
                schoolId: "",
                personId: '',
                name: "",
                company: "",
                email: "",
                verifyCode: ""
            },
        },

        methods:{
            jump(){
                location.href='index.html';
            },
            submit(){
                if(this.formData.email!=""&&this.formData.verifyCode==""){
                    this.$message.error("请输入验证码");
                }else {
                    axios.put("http://127.0.0.1:8080/users/completeInfo",this.formData,{withCredentials: true}).then((res)=>{
                        if(res.data.code==2001){
                            this.$message.success(res.data.msg);
                            let userInfoString = JSON.stringify(res.data.data);
                            // 将字符串存入 localstorage
                            localStorage.setItem('userInfo', userInfoString);
                            setTimeout(function jumpToLogin() {
                                    window.location.href='/my.html';
                                }
                                ,3000);
                        }else{
                            this.$message.error(res.data.msg);
                        }
                    }).catch(function (err) {
                        console.log(err);
                        this.$message.error("服务异常，请联系管理员");
                    })
                }
            },
            handleAvatarSuccess(res, file) {
                if(res.code==2001) {
                    this.$message.success(res.msg);
                    this.imageUrl = URL.createObjectURL(file.raw);
                    this.userInfo.avatarPath=res.data;
                    let userInfoString = JSON.stringify(this.userInfo);
                    // 将字符串存入 localstorage
                    localStorage.setItem('userInfo', userInfoString);

                }else {
                    this.$message.error(res.msg);
                }
            },
            beforeAvatarUpload(file) {
                const isJPG = file.type === 'image/jpeg'||file.type === 'image/png'||file.type === 'image/jpg';
                const isLt2M = file.size / 1024 / 1024 < 10;

                if (!isJPG) {
                    this.$message.error('上传头像图片只能是 JPG JPEG 或 PNG 格式!');

                }
                if (!isLt2M) {
                    this.$message.error('上传头像图片大小不能超过 10MB!');
                }
                return isJPG && isLt2M;
            },

            sendEmail(){
                if(this.formData.email==""){
                    this.$message.error('请输入邮箱');
                    return;
                }
                axios.get("http://127.0.0.1:8080/users/sendEmail/"+this.formData.email,{withCredentials: true}).then((resp)=> {
                    // _this.reg_msg = resp.data;
                    if(resp.data.code==2000){
                        this.$message.error(resp.data.msg);
                    }else if(resp.data.code==2001){
                        this.$message.success(resp.data.msg);
                    }

                })
            },

        },
        created(){
            let userInfoString = localStorage.getItem('userInfo');

            // 将字符串转换回 JavaScript 对象
            this.userInfo = JSON.parse(userInfoString);
            axios.get("http://127.0.0.1:8080/users/school/",{withCredentials: true}).then((resp)=> {
                // _this.reg_msg = resp.data;
                if(resp.data.code==2000){
                    this.$message.error(resp.data.msg);
                }else if(resp.data.code==2001){
                    this.schools = resp.data.data;
                }

            }).catch(function (err) {
                console.log(err);
                this.$message.error("获取学校失败")
            })
        }



    })
</script>